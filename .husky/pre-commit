# Just run for all the apps right now

pnpm syncpack:fix --source apps/authx_authzed_api/package.json
pnpm syncpack:fix --source apps/authx_token_api/package.json
pnpm syncpack:fix --source apps/data_channel_gateway/package.json
pnpm syncpack:fix --source apps/data_channel_registrar/package.json
pnpm syncpack:fix --source apps/issued-jwt-registry/package.json
pnpm syncpack:fix --source apps/organization_matchmaking/package.json
pnpm syncpack:fix --source apps/user-credentials-cache/package.json
pnpm syncpack:fix --source apps/catalyst-ui-worker/package.json

# Abort commit only if syncpack modified targeted package.json files

TARGETS="apps/authx_authzed_api/package.json apps/authx_token_api/package.json apps/data_channel_gateway/package.json apps/data_channel_registrar/package.json apps/issued-jwt-registry/package.json apps/organization_matchmaking/package.json apps/user-credentials-cache/package.json apps/catalyst-ui-worker/package.json"
if ! git diff --quiet -- $TARGETS; then
echo "Pre-commit: syncpack changed package.json files. Please review and stage them."
echo "Aborting commit."
exit 1
fi

pnpm lint-staged

pnpm test
